{% extends "base.html" %}
{% block content %}
<section>
    <h2>Records</h2>
    {% for record in records %}
    <article class="record-card">
        <header>
            <h3><a href="/records/{{ record.id }}">{{ record.title }}</a></h3>
            <small>{{ record.created_at }} UTC</small>
        </header>
        <p>{{ record.body[:200] }}{% if record.body|length > 200 %}...{% endif %}</p>
        {% if analysis[record.id].time_ambiguity %}
        <span class="badge">時間曖昧: {{ analysis[record.id].time_ambiguity }}</span>
        {% endif %}
    </article>
    {% else %}
    <p>まだ記録がありません。</p>
    {% endfor %}
</section>

<section>
    <h2>New Record</h2>
    <form method="post" action="/records">
        <label>Title
            <input type="text" name="title" required maxlength="200">
        </label>
        <label>Body
            <textarea name="body" required rows="4"></textarea>
        </label>
        <label>Source URL (optional)
            <input type="url" name="source_url" placeholder="https://example.com">
        </label>

        <label>Center datetime (UTC, 必須)
            <input
                type="datetime-local"
                name="center"
                required
                value="{{ center.astimezone().replace(tzinfo=None).isoformat(timespec='minutes') }}"
                hx-get="/records/resolution-preview"
                hx-target="#resolution-preview"
                hx-trigger="change[validity.valid]"
                hx-params="serialize"
            >
        </label>
        <div class="slider-row">
            <label for="resolution_hours">Resolution (hours)</label>
            <input
                type="range"
                id="resolution_hours"
                name="resolution_hours"
                min="1"
                max="168"
                step="1"
                value="{{ resolution_hours }}"
                hx-get="/records/resolution-preview"
                hx-target="#resolution-preview"
                hx-trigger="change"
                hx-params="serialize"
            >
            <span id="resolution_value">{{ resolution_hours }}</span>h
        </div>
        <div id="resolution-preview">
            {% include "partials/resolution_preview.html" %}
        </div>

        <button type="submit">Save Record</button>
    </form>
</section>

<script>
    const slider = document.getElementById('resolution_hours');
    const valueSpan = document.getElementById('resolution_value');
    slider?.addEventListener('input', () => valueSpan.textContent = slider.value);
</script>
{% endblock %}
